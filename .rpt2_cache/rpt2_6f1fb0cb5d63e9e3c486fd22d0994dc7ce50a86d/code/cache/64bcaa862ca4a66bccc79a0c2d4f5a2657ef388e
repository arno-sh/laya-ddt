{
  "code": "var Event = Laya.Event;\r\nvar SoundManager = Laya.SoundManager;\r\nexport default class LogicManager {\r\n    constructor() {\r\n        this.top_box_color = null;\r\n        this.bg_front = null;\r\n        this.bg_black = null;\r\n        this.move_is_x = false;\r\n        this.boxHeight = 0.14;\r\n        this.top_y = 0.5;\r\n        this.top_max_x = 1.5;\r\n        this.top_max_z = 1.5;\r\n        this.top_box_speed = 0.02;\r\n        this.top_box = null;\r\n        this.last_box_postion = null;\r\n        this.last_box_x_len = 0;\r\n        this.last_box_z_len = 0;\r\n        this.top_box_x_len = 0;\r\n        this.top_box_z_len = 0;\r\n        this.camera_org_pos = null;\r\n        this.layer = 0;\r\n        this.camera_target_pos = null;\r\n        this.camera_temp_pos = null;\r\n        this.camera_size = 1;\r\n        this.score = 0;\r\n        this.listBox = new Array();\r\n        this.init = false;\r\n        this.life = 2;\r\n        this.color_idx = -1;\r\n        this.color_dir = 1;\r\n        this.soundLayer = 1;\r\n        this.combo = 0;\r\n    }\r\n    static getInstance() {\r\n        if (this._instance == null) {\r\n            this._instance = new LogicManager();\r\n        }\r\n        return this._instance;\r\n    }\r\n    Reset() {\r\n        if (this.top_box)\r\n            this.top_box.destroy();\r\n        Laya.timer.clearAll(this);\r\n        Laya.stage.off(Event.MOUSE_DOWN, this, this.OnClick);\r\n        LogicManager.game_ui.btn_continue.off(Event.MOUSE_DOWN, this, this.OnContinueGame);\r\n        LogicManager.game_ui.btn_reset.off(Event.MOUSE_DOWN, this, this.OnResetGame);\r\n        this.listBox.forEach(element => {\r\n            element.destroy();\r\n        });\r\n        this.listBox = new Array();\r\n        LogicManager.camera.transform.position = this.camera_org_pos;\r\n        LogicManager.camera.orthographicVerticalSize = this.camera_size;\r\n        this.top_box_color = new Laya.Vector4(Math.random(), Math.random(), Math.random(), 1);\r\n        let mat = LogicManager.bottomCube.meshRenderer.material;\r\n        mat.albedoColor = this.top_box_color;\r\n        this.Init();\r\n    }\r\n    Init() {\r\n        console.log(\"init\");\r\n        if (!this.init) {\r\n            this.camera_org_pos = LogicManager.camera.transform.position;\r\n            this.camera_size = LogicManager.camera.orthographicVerticalSize;\r\n            this.camera_org_pos = new Laya.Vector3(this.camera_org_pos.x, this.camera_org_pos.y, this.camera_org_pos.z);\r\n            this.init = true;\r\n        }\r\n        this.camera_target_pos = new Laya.Vector3(this.camera_org_pos.x, this.camera_org_pos.y, this.camera_org_pos.z);\r\n        this.color_idx = -1;\r\n        this.top_y = 0.5;\r\n        this.top_y += this.boxHeight / 2;\r\n        this.top_box_color = this.GetNextColor(this.top_box_color);\r\n        this.last_box_postion = new Laya.Vector3(0, 0, 0);\r\n        this.last_box_x_len = 1;\r\n        this.last_box_z_len = 1;\r\n        this.top_box_x_len = 1;\r\n        this.top_box_z_len = 1;\r\n        this.layer = 1;\r\n        this.score = 0;\r\n        this.life = 0;\r\n        this.top_box_speed = 0.02;\r\n        this.soundLayer = 1;\r\n        this.combo = 0;\r\n        LogicManager.game_ui.lable_score.text = \"\" + this.score;\r\n        this.top_box = this.CreateBox(new Laya.Vector3(this.top_max_x * -1, this.top_y, 0), this.top_box_color, this.top_box_x_len, this.top_box_z_len);\r\n        this.ToMaxX(this.top_box);\r\n        this.move_is_x = true;\r\n        Laya.stage.on(Event.MOUSE_DOWN, this, this.OnClick);\r\n        LogicManager.game_ui.btn_continue.on(Event.MOUSE_DOWN, this, this.OnContinueGame);\r\n        LogicManager.game_ui.btn_reset.on(Event.MOUSE_DOWN, this, this.OnResetGame);\r\n    }\r\n    ChangeSpeed() {\r\n        let factor = Math.floor(this.layer / 5);\r\n        this.top_box_speed = 0.02 + (0.004 * factor);\r\n    }\r\n    OnGameOver(e) {\r\n        e.stopPropagation();\r\n        LogicManager.game_ui.box_tower.visible = false;\r\n        if (this.top_box)\r\n            this.top_box.destroy();\r\n        Laya.timer.clearAll(this);\r\n        Laya.stage.off(Event.MOUSE_DOWN, this, this.OnGameOver);\r\n        Laya.stage.off(Event.MOUSE_DOWN, this, this.OnClick);\r\n        LogicManager.game_ui.btn_continue.off(Event.MOUSE_DOWN, this, this.OnContinueGame);\r\n        LogicManager.game_ui.btn_reset.off(Event.MOUSE_DOWN, this, this.OnResetGame);\r\n        this.listBox.forEach(element => {\r\n            element.destroy();\r\n        });\r\n        this.listBox = new Array();\r\n        LogicManager.camera.transform.position = this.camera_org_pos;\r\n        LogicManager.camera.orthographicVerticalSize = this.camera_size;\r\n        LogicManager.game_ui.lable_score.visible = false;\r\n        LogicManager.game_ui.box_start.visible = true;\r\n        this.top_box_color = new Laya.Vector4(Math.random(), Math.random(), Math.random(), 1);\r\n        let mat = LogicManager.bottomCube.meshRenderer.material;\r\n        mat.albedoColor = this.top_box_color;\r\n    }\r\n    OnResetGame(e) {\r\n        e.stopPropagation();\r\n        LogicManager.game_ui.box_continue.visible = false;\r\n        LogicManager.game_ui.box_start.visible = false;\r\n        this.Reset();\r\n    }\r\n    OnClick(e) {\r\n        e.stopPropagation();\r\n        Laya.timer.clearAll(this);\r\n        Laya.stage.off(Event.MOUSE_DOWN, this, this.OnClick);\r\n        if (this.move_is_x) {\r\n            let distX = Math.abs(this.top_box.transform.position.x - this.last_box_postion.x);\r\n            let halfX = (this.top_box_x_len + this.last_box_x_len) / 2;\r\n            if (distX < halfX) {\r\n                let overlap = halfX - distX;\r\n                let reserved_box_pos_x = 0;\r\n                let drop_box_pos_x = 0;\r\n                let drop_box_x_len = this.top_box_x_len - overlap;\r\n                let x_force = 0;\r\n                if (this.top_box.transform.position.x > this.last_box_postion.x) {\r\n                    reserved_box_pos_x = this.last_box_postion.x + (this.last_box_x_len / 2 - overlap) + overlap / 2;\r\n                    drop_box_pos_x = this.last_box_postion.x + this.last_box_x_len / 2 + drop_box_x_len / 2;\r\n                    x_force = 2.0;\r\n                }\r\n                else {\r\n                    reserved_box_pos_x = this.last_box_postion.x - (this.last_box_x_len / 2 - overlap) - overlap / 2;\r\n                    drop_box_pos_x = this.last_box_postion.x - this.last_box_x_len / 2 - drop_box_x_len / 2;\r\n                    x_force = -2.0;\r\n                }\r\n                if (distX < 0.1) {\r\n                    let pos = new Laya.Vector3(this.last_box_postion.x, this.top_y, this.last_box_postion.z);\r\n                    this.top_box.transform.position = new Laya.Vector3(pos.x, pos.y, pos.z);\r\n                    pos.y -= this.boxHeight / 2;\r\n                    this.CreateEffect(pos, new Laya.Vector4(1.0, 1.0, 1.0, 1.0), this.last_box_x_len + 0.15, this.last_box_z_len + 0.15);\r\n                    this.combo++;\r\n                    this.score += (1 + this.combo);\r\n                    this.ScoreAnimation(1 + this.combo);\r\n                    this.listBox.push(this.top_box);\r\n                    LogicManager.game_ui.SetCombo(this.combo);\r\n                }\r\n                else {\r\n                    let reserved_box = this.CreateBox(new Laya.Vector3(reserved_box_pos_x, this.top_y, this.last_box_postion.z), this.top_box_color, overlap, this.last_box_z_len);\r\n                    let drop_box = this.CreateBox(new Laya.Vector3(drop_box_pos_x, this.top_y, this.last_box_postion.z), this.top_box_color, drop_box_x_len, this.last_box_z_len);\r\n                    this.listBox.push(reserved_box);\r\n                    this.last_box_postion = reserved_box.transform.position;\r\n                    this.last_box_x_len = overlap;\r\n                    this.top_box_x_len = overlap;\r\n                    this.top_box.destroy();\r\n                    let box_shape = new Laya.BoxColliderShape(drop_box_x_len, this.boxHeight, this.last_box_z_len);\r\n                    let drop_box_rigid = drop_box.addComponent(Laya.Rigidbody3D);\r\n                    drop_box_rigid.colliderShape = box_shape;\r\n                    drop_box_rigid.applyImpulse(new Laya.Vector3(x_force, 0, 0));\r\n                    drop_box_rigid.applyTorqueImpulse(new Laya.Vector3(0, 0, x_force / 30));\r\n                    Laya.timer.once(3000, this, () => {\r\n                        drop_box.destroy();\r\n                        console.log(\"drop_box_x destroy!!!!\");\r\n                    });\r\n                    this.score += 1;\r\n                    this.ScoreAnimation(1);\r\n                    this.combo = 0;\r\n                }\r\n                this.top_box_color = this.GetNextColor(this.top_box_color);\r\n                this.top_y += this.boxHeight;\r\n                ++this.layer;\r\n                this.ChangeSpeed();\r\n                this.BGAni();\r\n                SoundManager.playSound(\"mp3/s\" + Math.abs(this.soundLayer) + \".mp3\", 1);\r\n                if (this.soundLayer > 0) {\r\n                    this.soundLayer++;\r\n                    if (this.soundLayer > 8) {\r\n                        this.soundLayer = -7;\r\n                    }\r\n                }\r\n                else {\r\n                    this.soundLayer++;\r\n                    if (this.soundLayer === 0) {\r\n                        this.soundLayer = 2;\r\n                    }\r\n                }\r\n                if (this.layer > 4) {\r\n                    this.camera_target_pos.y += this.boxHeight;\r\n                    this.camera_temp_pos = LogicManager.camera.transform.position;\r\n                    Laya.Tween.to(this.camera_temp_pos, {\r\n                        y: this.camera_target_pos.y,\r\n                        update: new Laya.Handler(this, function () {\r\n                            LogicManager.camera.transform.position = this.camera_temp_pos;\r\n                        })\r\n                    }, 500, Laya.Ease.linearInOut);\r\n                }\r\n                this.move_is_x = false;\r\n                this.top_box = this.CreateBox(new Laya.Vector3(this.last_box_postion.x, this.top_y, this.top_max_z), this.top_box_color, this.last_box_x_len, this.last_box_z_len);\r\n                this.ToMinZ(this.top_box);\r\n                Laya.timer.once(300, this, () => {\r\n                    Laya.stage.on(Event.MOUSE_DOWN, this, this.OnClick);\r\n                });\r\n            }\r\n            else {\r\n                console.log(\"失败!!!!!!!!!!!!!!\");\r\n                this.combo = 0;\r\n                --this.life;\r\n                if (this.life < 0) {\r\n                    this.top_box.destroy();\r\n                    this.top_box = null;\r\n                }\r\n                let size = Math.ceil(this.camera_size + this.top_y);\r\n                let speed = (size - LogicManager.camera.orthographicVerticalSize) / 50;\r\n                Laya.timer.loop(20, this, this.CameraFarAni, [size, speed]);\r\n            }\r\n        }\r\n        else {\r\n            let distZ = Math.abs(this.top_box.transform.position.z - this.last_box_postion.z);\r\n            let halfZ = (this.top_box_z_len + this.last_box_z_len) / 2;\r\n            if (distZ < halfZ) {\r\n                let overlap = halfZ - distZ;\r\n                let reserved_box_pos_z = 0;\r\n                let drop_box_pos_z = 0;\r\n                let drop_box_z_len = this.top_box_z_len - overlap;\r\n                let z_force = 0;\r\n                if (this.top_box.transform.position.z > this.last_box_postion.z) {\r\n                    reserved_box_pos_z = this.last_box_postion.z + (this.last_box_z_len / 2 - overlap) + overlap / 2;\r\n                    drop_box_pos_z = this.last_box_postion.z + this.last_box_x_len / 2 + drop_box_z_len / 2;\r\n                    z_force = 2.0;\r\n                }\r\n                else {\r\n                    reserved_box_pos_z = this.last_box_postion.z - (this.last_box_z_len / 2 - overlap) - overlap / 2;\r\n                    drop_box_pos_z = this.last_box_postion.z - this.last_box_z_len / 2 - drop_box_z_len / 2;\r\n                    z_force = -2.0;\r\n                }\r\n                if (distZ < 0.1) {\r\n                    let pos = new Laya.Vector3(this.last_box_postion.x, this.top_y, this.last_box_postion.z);\r\n                    this.top_box.transform.position = new Laya.Vector3(pos.x, pos.y, pos.z);\r\n                    pos.y -= this.boxHeight / 2;\r\n                    this.CreateEffect(pos, new Laya.Vector4(1.0, 1.0, 1.0, 1.0), this.last_box_x_len + 0.15, this.last_box_z_len + 0.15);\r\n                    this.combo++;\r\n                    this.score += (1 + this.combo);\r\n                    this.ScoreAnimation(1 + this.combo);\r\n                    this.listBox.push(this.top_box);\r\n                    LogicManager.game_ui.SetCombo(this.combo);\r\n                }\r\n                else {\r\n                    let reserved_box = this.CreateBox(new Laya.Vector3(this.last_box_postion.x, this.top_y, reserved_box_pos_z), this.top_box_color, this.last_box_x_len, overlap);\r\n                    let drop_box = this.CreateBox(new Laya.Vector3(this.last_box_postion.x, this.top_y, drop_box_pos_z), this.top_box_color, this.last_box_x_len, drop_box_z_len);\r\n                    this.listBox.push(reserved_box);\r\n                    this.last_box_postion = reserved_box.transform.position;\r\n                    this.last_box_z_len = overlap;\r\n                    this.top_box_z_len = overlap;\r\n                    this.top_box.destroy();\r\n                    let box_shape = new Laya.BoxColliderShape(this.last_box_x_len, this.boxHeight, drop_box_z_len);\r\n                    let drop_box_rigid = drop_box.addComponent(Laya.Rigidbody3D);\r\n                    drop_box_rigid.colliderShape = box_shape;\r\n                    drop_box_rigid.applyImpulse(new Laya.Vector3(0, 0, z_force));\r\n                    drop_box_rigid.applyTorqueImpulse(new Laya.Vector3(z_force / 30 * -1, 0, 0));\r\n                    Laya.timer.once(3000, this, () => {\r\n                        drop_box.destroy();\r\n                        console.log(\"drop_box_z destroy!!!!\");\r\n                    });\r\n                    this.score += 1;\r\n                    this.ScoreAnimation(1);\r\n                    this.combo = 0;\r\n                }\r\n                this.top_box_color = this.GetNextColor(this.top_box_color);\r\n                this.top_y += this.boxHeight;\r\n                ++this.layer;\r\n                this.ChangeSpeed();\r\n                this.BGAni();\r\n                SoundManager.playSound(\"mp3/s\" + Math.abs(this.soundLayer) + \".mp3\", 1);\r\n                if (this.soundLayer > 0) {\r\n                    this.soundLayer++;\r\n                    if (this.soundLayer > 8) {\r\n                        this.soundLayer = -7;\r\n                    }\r\n                }\r\n                else {\r\n                    this.soundLayer++;\r\n                    if (this.soundLayer >= 0) {\r\n                        this.soundLayer = 2;\r\n                    }\r\n                }\r\n                if (this.layer > 4) {\r\n                    this.camera_target_pos.y += this.boxHeight;\r\n                    this.camera_temp_pos = LogicManager.camera.transform.position;\r\n                    Laya.Tween.to(this.camera_temp_pos, {\r\n                        y: this.camera_target_pos.y,\r\n                        update: new Laya.Handler(this, function () {\r\n                            LogicManager.camera.transform.position = this.camera_temp_pos;\r\n                        })\r\n                    }, 500, Laya.Ease.linearInOut);\r\n                }\r\n                this.move_is_x = true;\r\n                this.top_box = this.CreateBox(new Laya.Vector3(this.top_max_x * -1, this.top_y, this.last_box_postion.z), this.top_box_color, this.last_box_x_len, this.last_box_z_len);\r\n                this.ToMaxX(this.top_box);\r\n                Laya.timer.once(300, this, () => {\r\n                    Laya.stage.on(Event.MOUSE_DOWN, this, this.OnClick);\r\n                });\r\n            }\r\n            else {\r\n                console.log(\"失败!!!!!!!!!!!!!!\");\r\n                this.combo = 0;\r\n                --this.life;\r\n                if (this.life < 0) {\r\n                    this.top_box.destroy();\r\n                    this.top_box = null;\r\n                }\r\n                let size = Math.ceil(this.camera_size + this.top_y);\r\n                let speed = (size - LogicManager.camera.orthographicVerticalSize) / 50;\r\n                Laya.timer.loop(20, this, this.CameraFarAni, [size, speed]);\r\n            }\r\n        }\r\n    }\r\n    BGAni() {\r\n        this.bg_front.colorA += 0.01;\r\n        if (this.bg_front.colorA >= 0.06) {\r\n            this.bg_front.colorA = 0.01;\r\n            Laya.Texture2D.load(\"bg/img_fyd_bg\" + LogicManager.randomNum(10) + \".jpg\", Laya.Handler.create(this, function (tex) {\r\n                this.bg_front.texture = tex;\r\n            }));\r\n            Laya.Texture2D.load(\"bg/img_fyd_bg\" + LogicManager.randomNum(9) + \".jpg\", Laya.Handler.create(this, function (tex) {\r\n                this.bg_black.albedoTexture = tex;\r\n            }));\r\n        }\r\n    }\r\n    CameraFarAni(size, speed) {\r\n        LogicManager.camera.orthographicVerticalSize += speed;\r\n        if (LogicManager.camera.orthographicVerticalSize >= size) {\r\n            LogicManager.camera.orthographicVerticalSize = size;\r\n            Laya.timer.clear(this, this.CameraFarAni);\r\n            this.camera_temp_pos = new Laya.Vector3(LogicManager.camera.transform.position.x, LogicManager.camera.transform.position.y, LogicManager.camera.transform.position.z);\r\n            let _y = this.camera_temp_pos.y - Math.ceil(this.top_y / 3);\r\n            Laya.Tween.to(this.camera_temp_pos, { y: _y, update: new Laya.Handler(this, function () {\r\n                    LogicManager.camera.transform.position = this.camera_temp_pos;\r\n                }) }, 500, Laya.Ease.linearInOut, new Laya.Handler(this, function () {\r\n                if (this.life >= 0) {\r\n                    LogicManager.game_ui.box_continue.visible = true;\r\n                }\r\n                else {\r\n                    LogicManager.game_ui.ShowTowerName(this.score);\r\n                    Laya.timer.once(6000, this, () => {\r\n                        Laya.stage.on(Event.MOUSE_DOWN, this, this.OnGameOver);\r\n                    });\r\n                }\r\n            }));\r\n        }\r\n    }\r\n    CameraNearAni(size, speed) {\r\n        LogicManager.camera.orthographicVerticalSize -= speed;\r\n        if (LogicManager.camera.orthographicVerticalSize <= size) {\r\n            LogicManager.camera.orthographicVerticalSize = size;\r\n            this.last_box_postion = new Laya.Vector3(0, 0, 0);\r\n            this.last_box_x_len = 1;\r\n            this.last_box_z_len = 1;\r\n            this.top_box_x_len = 1;\r\n            this.top_box_z_len = 1;\r\n            this.top_box = this.CreateBox(new Laya.Vector3(this.top_max_x * -1, this.top_y, 0), this.top_box_color, this.top_box_x_len, this.top_box_z_len);\r\n            this.ToMaxX(this.top_box);\r\n            this.move_is_x = true;\r\n            Laya.stage.on(Event.MOUSE_DOWN, this, this.OnClick);\r\n            Laya.timer.clear(this, this.CameraNearAni);\r\n        }\r\n    }\r\n    OnContinueGame(e) {\r\n        console.log(\"ContinueGame\");\r\n        e.stopPropagation();\r\n        this.top_box.destroy();\r\n        LogicManager.game_ui.box_continue.visible = false;\r\n        this.listBox.push(this.CreateBox(new Laya.Vector3(0, this.top_y, 0), this.top_box_color, 0.3, 0.3));\r\n        this.top_box_color = this.GetNextColor(this.top_box_color);\r\n        this.top_y += this.boxHeight;\r\n        for (let i = 1; i <= 5; ++i) {\r\n            this.listBox.push(this.CreateBox(new Laya.Vector3(0, this.top_y, 0), this.top_box_color, i / 5, i / 5));\r\n            this.top_y += this.boxHeight;\r\n            this.top_box_color = this.GetNextColor(this.top_box_color);\r\n            ++this.layer;\r\n            if (this.layer > 4) {\r\n                this.camera_target_pos.y += this.boxHeight;\r\n                this.camera_temp_pos = LogicManager.camera.transform.position;\r\n                Laya.Tween.to(this.camera_temp_pos, {\r\n                    y: this.camera_target_pos.y,\r\n                    update: new Laya.Handler(this, function () {\r\n                        LogicManager.camera.transform.position = this.camera_temp_pos;\r\n                    })\r\n                }, 500, Laya.Ease.linearInOut);\r\n            }\r\n        }\r\n        let speed = (LogicManager.camera.orthographicVerticalSize - this.camera_size) / 25;\r\n        Laya.timer.loop(20, this, this.CameraNearAni, [this.camera_size, speed]);\r\n    }\r\n    CreateEffect(pos, color, x_len, z_len) {\r\n        let box = LogicManager.scene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(x_len, 0.005, z_len)));\r\n        box.transform.translate(pos);\r\n        box.layer = 1;\r\n        let material = new Laya.UnlitMaterial();\r\n        material.albedoColor = color;\r\n        material.albedoColorA = 0;\r\n        material.renderMode = Laya.UnlitMaterial.RENDERMODE_TRANSPARENT;\r\n        box.meshRenderer.material = material;\r\n        Laya.timer.frameLoop(1, this, this.AlphaIn, [box, material]);\r\n        return box;\r\n    }\r\n    AlphaIn(box, material) {\r\n        let alpha = material.albedoColorA;\r\n        alpha += 0.05;\r\n        material.albedoColorA = alpha;\r\n        if (alpha >= 0.4) {\r\n            Laya.timer.clear(this, this.AlphaIn);\r\n            Laya.timer.frameLoop(1, this, this.AlphaOut, [box, material]);\r\n        }\r\n    }\r\n    AlphaOut(box, material) {\r\n        let alpha = material.albedoColorA;\r\n        alpha -= 0.05;\r\n        material.albedoColorA = alpha;\r\n        if (alpha <= 0) {\r\n            Laya.timer.clear(this, this.AlphaOut);\r\n            box.destroy();\r\n        }\r\n    }\r\n    CreateBox(pos, color, x_len, z_len) {\r\n        let box = LogicManager.scene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(x_len, this.boxHeight, z_len)));\r\n        box.transform.translate(pos);\r\n        box.layer = 1;\r\n        let material = new Laya.BlinnPhongMaterial();\r\n        material.albedoColor = color;\r\n        box.meshRenderer.material = material;\r\n        return box;\r\n    }\r\n    CreateCylinder(pos, color, radius) {\r\n        let box = LogicManager.scene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(radius, this.boxHeight, 30)));\r\n        box.transform.translate(pos);\r\n        box.layer = 1;\r\n        let material = new Laya.BlinnPhongMaterial();\r\n        material.albedoColor = color;\r\n        box.meshRenderer.material = material;\r\n        return box;\r\n    }\r\n    ToMinX(box) {\r\n        Laya.timer.frameLoop(1, this, this.CBToMinX, [box]);\r\n    }\r\n    CBToMinX(box) {\r\n        box.transform.localPositionX -= this.top_box_speed;\r\n        if (box.transform.localPositionX <= -this.top_max_x) {\r\n            box.transform.localPositionX = -this.top_max_x;\r\n            this.ToMaxX(box);\r\n            Laya.timer.clear(this, this.CBToMinX);\r\n        }\r\n    }\r\n    ToMaxX(box) {\r\n        Laya.timer.frameLoop(1, this, this.CBToMaxX, [box]);\r\n    }\r\n    CBToMaxX(box) {\r\n        box.transform.localPositionX += this.top_box_speed;\r\n        if (box.transform.localPositionX >= this.top_max_x) {\r\n            box.transform.localPositionX = this.top_max_x;\r\n            this.ToMinX(box);\r\n            Laya.timer.clear(this, this.CBToMaxX);\r\n        }\r\n    }\r\n    ToMinZ(box) {\r\n        Laya.timer.frameLoop(1, this, this.CBToMinZ, [box]);\r\n    }\r\n    CBToMinZ(box) {\r\n        box.transform.localPositionZ -= this.top_box_speed;\r\n        if (box.transform.localPositionZ <= -this.top_max_z) {\r\n            box.transform.localPositionZ = -this.top_max_z;\r\n            this.ToMaxZ(box);\r\n            Laya.timer.clear(this, this.CBToMinZ);\r\n        }\r\n    }\r\n    ToMaxZ(box) {\r\n        Laya.timer.frameLoop(1, this, this.CBToMaxZ, [box]);\r\n    }\r\n    CBToMaxZ(box) {\r\n        box.transform.localPositionZ += this.top_box_speed;\r\n        if (box.transform.localPositionZ >= this.top_max_z) {\r\n            box.transform.localPositionZ = this.top_max_z;\r\n            this.ToMinZ(box);\r\n            Laya.timer.clear(this, this.CBToMaxZ);\r\n        }\r\n    }\r\n    ScoreAnimation(score) {\r\n        let text = new Laya.Text();\r\n        text.text = \"+\" + score;\r\n        text.align = \"center\";\r\n        text.fontSize = 50;\r\n        text.color = \"#ffffff\";\r\n        LogicManager.game_ui.addChild(text);\r\n        text.x = Laya.stage.width / 2 - 30;\r\n        text.y = LogicManager.game_ui.lable_score.y;\r\n        Laya.Tween.from(text, { x: Laya.stage.width / 2, y: LogicManager.game_ui.lable_score.y + 200, scaleX: 0, scaleY: 0 }, 500, Laya.Ease.linearInOut, Laya.Handler.create(this, () => {\r\n            text.destroy();\r\n            LogicManager.game_ui.lable_score.text = \"\" + this.score;\r\n        }));\r\n    }\r\n    GetNextColor(curColor) {\r\n        let color = new Laya.Vector4(curColor.x, curColor.y, curColor.z, 1);\r\n        let step = 20;\r\n        let vels = [color.x, color.y, color.z];\r\n        while (this.color_idx < 0) {\r\n            let rand = Math.random();\r\n            this.color_idx = rand < 0.33 ? 0 : (rand < 0.66 ? 1 : 2);\r\n            this.color_dir = 1;\r\n            if (vels[this.color_idx] > 0.95) {\r\n                this.color_dir = -1;\r\n            }\r\n        }\r\n        switch (this.color_idx) {\r\n            case 0:\r\n                color.x += (1 / step * this.color_dir);\r\n                vels[0] = color.x;\r\n                break;\r\n            case 1:\r\n                color.y += (1 / step * this.color_dir);\r\n                vels[1] = color.y;\r\n                break;\r\n            case 2:\r\n                color.z += (1 / step * this.color_dir);\r\n                vels[2] = color.z;\r\n                break;\r\n        }\r\n        if (this.color_dir == 1 && vels[this.color_idx] > 0.95) {\r\n            this.color_dir = -1;\r\n            this.color_idx = -1;\r\n        }\r\n        if (this.color_dir == -1 && vels[this.color_idx] < 0.05) {\r\n            this.color_dir = 1;\r\n            this.color_idx = -1;\r\n        }\r\n        return color;\r\n    }\r\n    static randomNum(num) {\r\n        return Math.floor(Math.random() * num);\r\n    }\r\n}\r\nLogicManager.camera = null;\r\nLogicManager.scene = null;\r\nLogicManager.game_ui = null;\r\nLogicManager.bottomCube = null;\r\n",
  "references": [
    "G:/work/laya/Project/ddt/laya-ddt/src/script/GameUI.ts",
    "G:/work/laya/Project/ddt/laya-ddt/src/GameConfig.ts"
  ]
}
