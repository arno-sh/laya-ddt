{
  "code": "import { ui } from \"./../ui/layaMaxUI\";\r\nimport LogicManager from \"../LogicManager\";\r\nvar Event = Laya.Event;\r\nexport default class GameUI extends ui.test.TestSceneUI {\r\n    constructor() {\r\n        super();\r\n        this.allLables = new Array();\r\n        this.bestScore = 0;\r\n        this.gID = \"\";\r\n        this.lblRanks = new Array();\r\n        LogicManager.game_ui = this;\r\n        this.box_combo.visible = false;\r\n        this.box_tower.visible = false;\r\n        this.allLables.push(this.lable_0);\r\n        this.allLables.push(this.lable_1);\r\n        this.allLables.push(this.lable_2);\r\n        this.allLables.push(this.lable_3);\r\n        this.allLables.push(this.lable_4);\r\n        this.allLables.push(this.lable_5);\r\n        this.allLables.push(this.lable_6);\r\n        this.allLables.push(this.lable_7);\r\n        this.allLables.push(this.lable_8);\r\n        this.allLables.push(this.lable_9);\r\n        this.allLables.forEach(element => {\r\n            element.text = \"\";\r\n        });\r\n        this.lblRanks.push(this.lblRank_1);\r\n        this.lblRanks.push(this.lblRank_2);\r\n        this.lblRanks.push(this.lblRank_3);\r\n        this.lblRanks.push(this.lblRank_4);\r\n        this.lblRanks.push(this.lblRank_5);\r\n        this.lblRanks.push(this.lblRank_6);\r\n        this.lblRanks.push(this.lblRank_7);\r\n        this.lblRanks.push(this.lblRank_8);\r\n        this.lblRanks.push(this.lblRank_9);\r\n        this.lblRanks.push(this.lblRank_10);\r\n        this.btn_start.on(Event.MOUSE_DOWN, this, this.OnStart);\r\n        this.btn_more.on(Event.MOUSE_DOWN, this, this.onMore);\r\n        this.btn_rank.on(Event.MOUSE_DOWN, this, this.onRank);\r\n        this.btn_rank_return.on(Event.MOUSE_DOWN, this, this.onCloseRank);\r\n        this.gID = this.cans();\r\n        this.OnRestart();\r\n    }\r\n    OnRestart() {\r\n        this.bestScore = GameUI.getLocalStorage(\"bestScore\", 0);\r\n        this.lblBestScore.text = \"\" + this.bestScore;\r\n        this.textGID.text = \"ID-\" + this.gID;\r\n        if (this.bestScore > 0) {\r\n            this.netPushScore(this.bestScore);\r\n        }\r\n        this.boxRank.visible = false;\r\n        this.btn_rank_return.visible = false;\r\n    }\r\n    OnStart(e) {\r\n        e.stopPropagation();\r\n        this.box_start.visible = false;\r\n        this.lable_score.visible = true;\r\n        this.box_tower.visible = false;\r\n        LogicManager.getInstance().Init();\r\n    }\r\n    onMore(e) {\r\n        e.stopPropagation();\r\n        window.location.href = 'http://www.doudoubird.com/ddn/newGame.html?from=groupmessage';\r\n    }\r\n    onRank(e) {\r\n        e.stopPropagation();\r\n        this.boxRank.visible = true;\r\n        this.btn_rank_return.visible = true;\r\n        this.httpGet(\"http://www.ask4kid.com:9001/get_rank?canvas_id=\" + this.gID + \"&game=ddt\", (res) => {\r\n            if (res && res.status === 0) {\r\n                if (res.info) {\r\n                    for (let index = 0; index < res.info.length; index++) {\r\n                        const element = res.info[index];\r\n                        if (element.canvas_id === this.gID) {\r\n                            this.lblRanks[index].text = \"\" + (index + 1) + \"-\" + element.canvas_id + \":(我)     \" + element.score;\r\n                            this.lblRanks[index].color = \"#ff0000\";\r\n                        }\r\n                        else {\r\n                            this.lblRanks[index].text = \"\" + (index + 1) + \"-\" + element.canvas_id + \":         \" + element.score;\r\n                            this.lblRanks[index].color = \"#1aa000\";\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    onCloseRank(e) {\r\n        e.stopPropagation();\r\n        this.boxRank.visible = false;\r\n        this.btn_rank_return.visible = false;\r\n    }\r\n    SetCombo(num) {\r\n        this.box_combo.visible = true;\r\n        this.box_combo.scaleX = 0;\r\n        this.box_combo.scaleY = 0;\r\n        if (num >= 100) {\r\n            let n1 = num % 10;\r\n            let n2 = Math.floor(num / 10) % 10;\r\n            let n3 = Math.floor(num / 100) % 10;\r\n            this.img_digtal_0.visible = true;\r\n            this.img_digtal_1.visible = true;\r\n            this.img_digtal_2.visible = true;\r\n            this.img_digtal_0.skin = \"comp/img_ddt_n\" + n3 + \".png\";\r\n            this.img_digtal_1.skin = \"comp/img_ddt_n\" + n2 + \".png\";\r\n            this.img_digtal_2.skin = \"comp/img_ddt_n\" + n1 + \".png\";\r\n        }\r\n        else if (num >= 10) {\r\n            let n1 = num % 10;\r\n            let n2 = Math.floor(num / 10) % 10;\r\n            this.img_digtal_0.visible = true;\r\n            this.img_digtal_1.visible = true;\r\n            this.img_digtal_2.visible = false;\r\n            this.img_digtal_0.skin = \"comp/img_ddt_n\" + n2 + \".png\";\r\n            this.img_digtal_1.skin = \"comp/img_ddt_n\" + n1 + \".png\";\r\n        }\r\n        else {\r\n            let n1 = num % 10;\r\n            this.img_digtal_0.visible = true;\r\n            this.img_digtal_1.visible = false;\r\n            this.img_digtal_2.visible = false;\r\n            this.img_digtal_0.skin = \"comp/img_ddt_n\" + n1 + \".png\";\r\n        }\r\n        Laya.Tween.to(this.box_combo, { scaleX: 1, scaleY: 1 }, 250, Laya.Ease.elasticOut, Laya.Handler.create(this, () => {\r\n            Laya.Tween.to(this.box_combo, { scaleX: 0, scaleY: 0 }, 250, Laya.Ease.linearInOut, Laya.Handler.create(this, () => {\r\n                this.box_combo.visible = false;\r\n            }), 100);\r\n        }));\r\n    }\r\n    ShowTowerName(score) {\r\n        this.box_tower.visible = true;\r\n        this.allLables.forEach(element => {\r\n            element.scaleX = 0;\r\n            element.scaleY = 0;\r\n            element.text = \"\";\r\n        });\r\n        let tower = \"香格里拉大酒店\";\r\n        if (score < 40) {\r\n            tower = \"香格里拉大酒店\";\r\n        }\r\n        else if (score < 80) {\r\n            tower = \"南京紫峰大厦\";\r\n        }\r\n        else if (score < 100) {\r\n            tower = \"长沙国际金融中心\";\r\n        }\r\n        else if (score < 120) {\r\n            tower = \"武汉绿地中心\";\r\n        }\r\n        else if (score < 140) {\r\n            tower = \"香港环球贸易广场\";\r\n        }\r\n        else if (score < 160) {\r\n            tower = \"上海环球金融中心\";\r\n        }\r\n        else if (score < 180) {\r\n            tower = \"台北101大厦\";\r\n        }\r\n        else if (score < 200) {\r\n            tower = \"北京中国尊\";\r\n        }\r\n        else if (score < 220) {\r\n            tower = \"广州周大福金融中心\";\r\n        }\r\n        else if (score < 240) {\r\n            tower = \"天津周大福滨海中心\";\r\n        }\r\n        else if (score < 260) {\r\n            tower = \"深圳平安国际金融中心\";\r\n        }\r\n        else if (score < 280) {\r\n            tower = \"天津117大厦\";\r\n        }\r\n        else {\r\n            tower = \"上海中心\";\r\n        }\r\n        if (score > this.bestScore) {\r\n            this.bestScore = score;\r\n            GameUI.setLocalStorage(\"bestScore\", score);\r\n            this.netPushScore(this.bestScore);\r\n        }\r\n        for (let i = 0; i < tower.length; ++i) {\r\n            this.allLables[i].text = tower[i];\r\n            Laya.Tween.to(this.allLables[i], { scaleX: 1, scaleY: 1 }, 500, Laya.Ease.sineOut, null, i * 300);\r\n        }\r\n    }\r\n    static getLocalStorage(key, def) {\r\n        var num = def;\r\n        var temp1 = Laya.LocalStorage.getItem(key);\r\n        if (temp1) {\r\n            var temp2 = Number(temp1);\r\n            if (isNaN(temp2)) {\r\n                num = def;\r\n                Laya.LocalStorage.setItem(key, num);\r\n            }\r\n            else {\r\n                num = parseInt(temp1);\r\n            }\r\n        }\r\n        else {\r\n            num = def;\r\n            Laya.LocalStorage.setItem(key, num);\r\n        }\r\n        return num;\r\n    }\r\n    static setLocalStorage(key, num) {\r\n        Laya.LocalStorage.setItem(key, num);\r\n    }\r\n    bin2hex(str) {\r\n        var result = \"\";\r\n        for (let i = 0; i < str.length; i++) {\r\n            result += this.int16_to_hex(str.charCodeAt(i));\r\n        }\r\n        return result;\r\n    }\r\n    int16_to_hex(i) {\r\n        var result = i.toString(16);\r\n        var j = 0;\r\n        while (j + result.length < 4) {\r\n            result = \"0\" + result;\r\n            j++;\r\n        }\r\n        return result;\r\n    }\r\n    cans() {\r\n        var canvas = document.createElement('canvas');\r\n        var ctx = canvas.getContext('2d');\r\n        var txt = 'www.flashflora.com';\r\n        ctx.textBaseline = \"top\";\r\n        ctx.font = \"14px 'Arial'\";\r\n        ctx.fillStyle = \"#f60\";\r\n        ctx.fillRect(125, 1, 62, 20);\r\n        ctx.fillStyle = \"#069\";\r\n        ctx.fillText(txt, 2, 15);\r\n        ctx.fillStyle = \"rgba(102, 204, 0, 0.7)\";\r\n        ctx.fillText(txt, 4, 17);\r\n        var b64 = canvas.toDataURL().replace(\"data:image/png;base64,\", \"\");\r\n        var bin = atob(b64);\r\n        var crc = this.bin2hex(bin.slice(-16, -12));\r\n        return crc;\r\n    }\r\n    httpGet(url, callback) {\r\n        let xhr = new Laya.HttpRequest();\r\n        xhr.once(Event.COMPLETE, this, () => {\r\n            callback(xhr.data);\r\n        });\r\n        xhr.http.withCredentials = false;\r\n        xhr.http.timeout = 8000;\r\n        xhr.send(url, \"\", \"get\", \"json\", [\"Content-Type\", \"application/json\", 'Access-Control-Allow-Origin', '*', 'Access-Control-Allow-Methods', 'GET, POST', 'Access-Control-Allow-Headers', 'x-requested-with,content-type,authorization']);\r\n    }\r\n    netPushScore(score) {\r\n        this.httpGet(\"http://www.ask4kid.com:9001/update_rank_asc?canvas_id=\" + this.gID + \"&game=ddt&score=\" + score, (res) => {\r\n        });\r\n    }\r\n}\r\n",
  "references": [
    "G:/work/laya/Project/ddt/laya-ddt/src/ui/layaMaxUI.ts",
    "G:/work/laya/Project/ddt/laya-ddt/src/LogicManager.ts"
  ]
}
