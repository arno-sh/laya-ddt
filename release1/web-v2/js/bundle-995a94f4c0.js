!function(){"use strict";var t,e=Laya.ClassUtils.regClass;!function(t){!function(t){class a extends Laya.Scene{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("test/TestScene")}}t.TestSceneUI=a,e("ui.test.TestSceneUI",a)}(t.test||(t.test={}))}(t||(t={}));var a=Laya.Event,o=Laya.SoundManager;class s{constructor(){this.top_box_color=null,this.bg_front=null,this.bg_black=null,this.move_is_x=!1,this.boxHeight=.14,this.top_y=.5,this.top_max_x=1.5,this.top_max_z=1.5,this.top_box_speed=.02,this.top_box=null,this.last_box_postion=null,this.last_box_x_len=0,this.last_box_z_len=0,this.top_box_x_len=0,this.top_box_z_len=0,this.camera_org_pos=null,this.layer=0,this.camera_target_pos=null,this.camera_temp_pos=null,this.camera_size=1,this.score=0,this.listBox=new Array,this.init=!1,this.life=2,this.color_idx=-1,this.color_dir=1,this.soundLayer=1,this.combo=0}static getInstance(){return null==this._instance&&(this._instance=new s),this._instance}Reset(){this.top_box&&this.top_box.destroy(),Laya.timer.clearAll(this),Laya.stage.off(a.MOUSE_DOWN,this,this.OnClick),s.game_ui.btn_continue.off(a.MOUSE_DOWN,this,this.OnContinueGame),s.game_ui.btn_reset.off(a.MOUSE_DOWN,this,this.OnResetGame),this.listBox.forEach(t=>{t.destroy()}),this.listBox=new Array,s.camera.transform.position=this.camera_org_pos,s.camera.orthographicVerticalSize=this.camera_size,this.top_box_color=new Laya.Vector4(Math.random(),Math.random(),Math.random(),1),s.bottomCube.meshRenderer.material.albedoColor=this.top_box_color,this.Init()}Init(){console.log("init"),this.init||(this.camera_org_pos=s.camera.transform.position,this.camera_size=s.camera.orthographicVerticalSize,this.camera_org_pos=new Laya.Vector3(this.camera_org_pos.x,this.camera_org_pos.y,this.camera_org_pos.z),this.init=!0),this.camera_target_pos=new Laya.Vector3(this.camera_org_pos.x,this.camera_org_pos.y,this.camera_org_pos.z),this.color_idx=-1,this.top_y=.5,this.top_y+=this.boxHeight/2,this.top_box_color=this.GetNextColor(this.top_box_color),this.last_box_postion=new Laya.Vector3(0,0,0),this.last_box_x_len=1,this.last_box_z_len=1,this.top_box_x_len=1,this.top_box_z_len=1,this.layer=1,this.score=0,this.life=0,this.top_box_speed=.02,this.soundLayer=1,this.combo=0,s.game_ui.lable_score.text=""+this.score,this.top_box=this.CreateBox(new Laya.Vector3(-1*this.top_max_x,this.top_y,0),this.top_box_color,this.top_box_x_len,this.top_box_z_len),this.ToMaxX(this.top_box),this.move_is_x=!0,Laya.stage.on(a.MOUSE_DOWN,this,this.OnClick),s.game_ui.btn_continue.on(a.MOUSE_DOWN,this,this.OnContinueGame),s.game_ui.btn_reset.on(a.MOUSE_DOWN,this,this.OnResetGame)}ChangeSpeed(){let t=Math.floor(this.layer/5);this.top_box_speed=.02+.004*t}OnGameOver(t){t.stopPropagation(),s.game_ui.box_tower.visible=!1,this.top_box&&this.top_box.destroy(),Laya.timer.clearAll(this),Laya.stage.off(a.MOUSE_DOWN,this,this.OnGameOver),Laya.stage.off(a.MOUSE_DOWN,this,this.OnClick),s.game_ui.btn_continue.off(a.MOUSE_DOWN,this,this.OnContinueGame),s.game_ui.btn_reset.off(a.MOUSE_DOWN,this,this.OnResetGame),this.listBox.forEach(t=>{t.destroy()}),this.listBox=new Array,s.camera.transform.position=this.camera_org_pos,s.camera.orthographicVerticalSize=this.camera_size,s.game_ui.lable_score.visible=!1,s.game_ui.box_start.visible=!0,s.game_ui.OnRestart(),this.top_box_color=new Laya.Vector4(Math.random(),Math.random(),Math.random(),1),s.bottomCube.meshRenderer.material.albedoColor=this.top_box_color}OnResetGame(t){t.stopPropagation(),s.game_ui.box_continue.visible=!1,s.game_ui.box_start.visible=!1,this.Reset()}OnClick(t){if(t.stopPropagation(),Laya.timer.clearAll(this),Laya.stage.off(a.MOUSE_DOWN,this,this.OnClick),this.move_is_x){let t=Math.abs(this.top_box.transform.position.x-this.last_box_postion.x),e=(this.top_box_x_len+this.last_box_x_len)/2;if(t<e){let i=e-t,r=0,l=0,h=this.top_box_x_len-i,n=0;if(this.top_box.transform.position.x>this.last_box_postion.x?(r=this.last_box_postion.x+(this.last_box_x_len/2-i)+i/2,l=this.last_box_postion.x+this.last_box_x_len/2+h/2,n=2):(r=this.last_box_postion.x-(this.last_box_x_len/2-i)-i/2,l=this.last_box_postion.x-this.last_box_x_len/2-h/2,n=-2),t<.1){let t=new Laya.Vector3(this.last_box_postion.x,this.top_y,this.last_box_postion.z);this.top_box.transform.position=new Laya.Vector3(t.x,t.y,t.z),t.y-=this.boxHeight/2,this.CreateEffect(t,new Laya.Vector4(1,1,1,1),this.last_box_x_len+.15,this.last_box_z_len+.15),this.combo++,this.score+=1+this.combo,this.ScoreAnimation(1+this.combo),this.listBox.push(this.top_box),s.game_ui.SetCombo(this.combo)}else{let t=this.CreateBox(new Laya.Vector3(r,this.top_y,this.last_box_postion.z),this.top_box_color,i,this.last_box_z_len),e=this.CreateBox(new Laya.Vector3(l,this.top_y,this.last_box_postion.z),this.top_box_color,h,this.last_box_z_len);this.listBox.push(t),this.last_box_postion=t.transform.position,this.last_box_x_len=i,this.top_box_x_len=i,this.top_box.destroy();let a=new Laya.BoxColliderShape(h,this.boxHeight,this.last_box_z_len),o=e.addComponent(Laya.Rigidbody3D);o.colliderShape=a,o.applyImpulse(new Laya.Vector3(n,0,0)),o.applyTorqueImpulse(new Laya.Vector3(0,0,n/30)),Laya.timer.once(3e3,this,()=>{e.destroy(),console.log("drop_box_x destroy!!!!")}),this.score+=1,this.ScoreAnimation(1),this.combo=0}this.top_box_color=this.GetNextColor(this.top_box_color),this.top_y+=this.boxHeight,++this.layer,this.ChangeSpeed(),this.BGAni(),o.playSound("mp3/s"+Math.abs(this.soundLayer)+".mp3",1),this.soundLayer>0?(this.soundLayer++,this.soundLayer>8&&(this.soundLayer=-7)):(this.soundLayer++,0===this.soundLayer&&(this.soundLayer=2)),this.layer>4&&(this.camera_target_pos.y+=this.boxHeight,this.camera_temp_pos=s.camera.transform.position,Laya.Tween.to(this.camera_temp_pos,{y:this.camera_target_pos.y,update:new Laya.Handler(this,function(){s.camera.transform.position=this.camera_temp_pos})},500,Laya.Ease.linearInOut)),this.move_is_x=!1,this.top_box=this.CreateBox(new Laya.Vector3(this.last_box_postion.x,this.top_y,this.top_max_z),this.top_box_color,this.last_box_x_len,this.last_box_z_len),this.ToMinZ(this.top_box),Laya.timer.once(300,this,()=>{Laya.stage.on(a.MOUSE_DOWN,this,this.OnClick)})}else{console.log("失败!!!!!!!!!!!!!!"),this.combo=0,--this.life,this.life<0&&(this.top_box.destroy(),this.top_box=null);let t=Math.ceil(this.camera_size+this.top_y),e=(t-s.camera.orthographicVerticalSize)/50;Laya.timer.loop(20,this,this.CameraFarAni,[t,e])}}else{let t=Math.abs(this.top_box.transform.position.z-this.last_box_postion.z),e=(this.top_box_z_len+this.last_box_z_len)/2;if(t<e){let i=e-t,r=0,l=0,h=this.top_box_z_len-i,n=0;if(this.top_box.transform.position.z>this.last_box_postion.z?(r=this.last_box_postion.z+(this.last_box_z_len/2-i)+i/2,l=this.last_box_postion.z+this.last_box_x_len/2+h/2,n=2):(r=this.last_box_postion.z-(this.last_box_z_len/2-i)-i/2,l=this.last_box_postion.z-this.last_box_z_len/2-h/2,n=-2),t<.1){let t=new Laya.Vector3(this.last_box_postion.x,this.top_y,this.last_box_postion.z);this.top_box.transform.position=new Laya.Vector3(t.x,t.y,t.z),t.y-=this.boxHeight/2,this.CreateEffect(t,new Laya.Vector4(1,1,1,1),this.last_box_x_len+.15,this.last_box_z_len+.15),this.combo++,this.score+=1+this.combo,this.ScoreAnimation(1+this.combo),this.listBox.push(this.top_box),s.game_ui.SetCombo(this.combo)}else{let t=this.CreateBox(new Laya.Vector3(this.last_box_postion.x,this.top_y,r),this.top_box_color,this.last_box_x_len,i),e=this.CreateBox(new Laya.Vector3(this.last_box_postion.x,this.top_y,l),this.top_box_color,this.last_box_x_len,h);this.listBox.push(t),this.last_box_postion=t.transform.position,this.last_box_z_len=i,this.top_box_z_len=i,this.top_box.destroy();let a=new Laya.BoxColliderShape(this.last_box_x_len,this.boxHeight,h),o=e.addComponent(Laya.Rigidbody3D);o.colliderShape=a,o.applyImpulse(new Laya.Vector3(0,0,n)),o.applyTorqueImpulse(new Laya.Vector3(n/30*-1,0,0)),Laya.timer.once(3e3,this,()=>{e.destroy(),console.log("drop_box_z destroy!!!!")}),this.score+=1,this.ScoreAnimation(1),this.combo=0}this.top_box_color=this.GetNextColor(this.top_box_color),this.top_y+=this.boxHeight,++this.layer,this.ChangeSpeed(),this.BGAni(),o.playSound("mp3/s"+Math.abs(this.soundLayer)+".mp3",1),this.soundLayer>0?(this.soundLayer++,this.soundLayer>8&&(this.soundLayer=-7)):(this.soundLayer++,this.soundLayer>=0&&(this.soundLayer=2)),this.layer>4&&(this.camera_target_pos.y+=this.boxHeight,this.camera_temp_pos=s.camera.transform.position,Laya.Tween.to(this.camera_temp_pos,{y:this.camera_target_pos.y,update:new Laya.Handler(this,function(){s.camera.transform.position=this.camera_temp_pos})},500,Laya.Ease.linearInOut)),this.move_is_x=!0,this.top_box=this.CreateBox(new Laya.Vector3(-1*this.top_max_x,this.top_y,this.last_box_postion.z),this.top_box_color,this.last_box_x_len,this.last_box_z_len),this.ToMaxX(this.top_box),Laya.timer.once(300,this,()=>{Laya.stage.on(a.MOUSE_DOWN,this,this.OnClick)})}else{console.log("失败!!!!!!!!!!!!!!"),this.combo=0,--this.life,this.life<0&&(this.top_box.destroy(),this.top_box=null);let t=Math.ceil(this.camera_size+this.top_y),e=(t-s.camera.orthographicVerticalSize)/50;Laya.timer.loop(20,this,this.CameraFarAni,[t,e])}}}BGAni(){this.bg_front.colorA+=.01,this.bg_front.colorA>=.06&&(this.bg_front.colorA=.01,Laya.Texture2D.load("bg/img_fyd_bg"+s.randomNum(10)+".jpg",Laya.Handler.create(this,function(t){this.bg_front.texture=t})),Laya.Texture2D.load("bg/img_fyd_bg"+s.randomNum(9)+".jpg",Laya.Handler.create(this,function(t){this.bg_black.albedoTexture=t})))}CameraFarAni(t,e){if(s.camera.orthographicVerticalSize+=e,s.camera.orthographicVerticalSize>=t){s.camera.orthographicVerticalSize=t,Laya.timer.clear(this,this.CameraFarAni),this.camera_temp_pos=new Laya.Vector3(s.camera.transform.position.x,s.camera.transform.position.y,s.camera.transform.position.z);let e=this.camera_temp_pos.y-Math.ceil(this.top_y/3);Laya.Tween.to(this.camera_temp_pos,{y:e,update:new Laya.Handler(this,function(){s.camera.transform.position=this.camera_temp_pos})},500,Laya.Ease.linearInOut,new Laya.Handler(this,function(){this.life>=0?s.game_ui.box_continue.visible=!0:(s.game_ui.ShowTowerName(this.score),Laya.timer.once(6e3,this,()=>{Laya.stage.on(a.MOUSE_DOWN,this,this.OnGameOver)}))}))}}CameraNearAni(t,e){s.camera.orthographicVerticalSize-=e,s.camera.orthographicVerticalSize<=t&&(s.camera.orthographicVerticalSize=t,this.last_box_postion=new Laya.Vector3(0,0,0),this.last_box_x_len=1,this.last_box_z_len=1,this.top_box_x_len=1,this.top_box_z_len=1,this.top_box=this.CreateBox(new Laya.Vector3(-1*this.top_max_x,this.top_y,0),this.top_box_color,this.top_box_x_len,this.top_box_z_len),this.ToMaxX(this.top_box),this.move_is_x=!0,Laya.stage.on(a.MOUSE_DOWN,this,this.OnClick),Laya.timer.clear(this,this.CameraNearAni))}OnContinueGame(t){console.log("ContinueGame"),t.stopPropagation(),this.top_box.destroy(),s.game_ui.box_continue.visible=!1,this.listBox.push(this.CreateBox(new Laya.Vector3(0,this.top_y,0),this.top_box_color,.3,.3)),this.top_box_color=this.GetNextColor(this.top_box_color),this.top_y+=this.boxHeight;for(let t=1;t<=5;++t)this.listBox.push(this.CreateBox(new Laya.Vector3(0,this.top_y,0),this.top_box_color,t/5,t/5)),this.top_y+=this.boxHeight,this.top_box_color=this.GetNextColor(this.top_box_color),++this.layer,this.layer>4&&(this.camera_target_pos.y+=this.boxHeight,this.camera_temp_pos=s.camera.transform.position,Laya.Tween.to(this.camera_temp_pos,{y:this.camera_target_pos.y,update:new Laya.Handler(this,function(){s.camera.transform.position=this.camera_temp_pos})},500,Laya.Ease.linearInOut));let e=(s.camera.orthographicVerticalSize-this.camera_size)/25;Laya.timer.loop(20,this,this.CameraNearAni,[this.camera_size,e])}CreateEffect(t,e,a,o){let i=s.scene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(a,.005,o)));i.transform.translate(t),i.layer=1;let r=new Laya.UnlitMaterial;return r.albedoColor=e,r.albedoColorA=0,r.renderMode=Laya.UnlitMaterial.RENDERMODE_TRANSPARENT,i.meshRenderer.material=r,Laya.timer.frameLoop(1,this,this.AlphaIn,[i,r]),i}AlphaIn(t,e){let a=e.albedoColorA;a+=.05,e.albedoColorA=a,a>=.4&&(Laya.timer.clear(this,this.AlphaIn),Laya.timer.frameLoop(1,this,this.AlphaOut,[t,e]))}AlphaOut(t,e){let a=e.albedoColorA;a-=.05,e.albedoColorA=a,a<=0&&(Laya.timer.clear(this,this.AlphaOut),t.destroy())}CreateBox(t,e,a,o){let i=s.scene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(a,this.boxHeight,o)));i.transform.translate(t),i.layer=1;let r=new Laya.BlinnPhongMaterial;return r.albedoColor=e,i.meshRenderer.material=r,i}CreateCylinder(t,e,a){let o=s.scene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(a,this.boxHeight,30)));o.transform.translate(t),o.layer=1;let i=new Laya.BlinnPhongMaterial;return i.albedoColor=e,o.meshRenderer.material=i,o}ToMinX(t){Laya.timer.frameLoop(1,this,this.CBToMinX,[t])}CBToMinX(t){t.transform.localPositionX-=this.top_box_speed,t.transform.localPositionX<=-this.top_max_x&&(t.transform.localPositionX=-this.top_max_x,this.ToMaxX(t),Laya.timer.clear(this,this.CBToMinX))}ToMaxX(t){Laya.timer.frameLoop(1,this,this.CBToMaxX,[t])}CBToMaxX(t){t.transform.localPositionX+=this.top_box_speed,t.transform.localPositionX>=this.top_max_x&&(t.transform.localPositionX=this.top_max_x,this.ToMinX(t),Laya.timer.clear(this,this.CBToMaxX))}ToMinZ(t){Laya.timer.frameLoop(1,this,this.CBToMinZ,[t])}CBToMinZ(t){t.transform.localPositionZ-=this.top_box_speed,t.transform.localPositionZ<=-this.top_max_z&&(t.transform.localPositionZ=-this.top_max_z,this.ToMaxZ(t),Laya.timer.clear(this,this.CBToMinZ))}ToMaxZ(t){Laya.timer.frameLoop(1,this,this.CBToMaxZ,[t])}CBToMaxZ(t){t.transform.localPositionZ+=this.top_box_speed,t.transform.localPositionZ>=this.top_max_z&&(t.transform.localPositionZ=this.top_max_z,this.ToMinZ(t),Laya.timer.clear(this,this.CBToMaxZ))}ScoreAnimation(t){let e=new Laya.Text;e.text="+"+t,e.align="center",e.fontSize=50,e.color="#ffffff",s.game_ui.addChild(e),e.x=Laya.stage.width/2-30,e.y=s.game_ui.lable_score.y,Laya.Tween.from(e,{x:Laya.stage.width/2,y:s.game_ui.lable_score.y+200,scaleX:0,scaleY:0},500,Laya.Ease.linearInOut,Laya.Handler.create(this,()=>{e.destroy(),s.game_ui.lable_score.text=""+this.score}))}GetNextColor(t){let e=new Laya.Vector4(t.x,t.y,t.z,1),a=[e.x,e.y,e.z];for(;this.color_idx<0;){let t=Math.random();this.color_idx=t<.33?0:t<.66?1:2,this.color_dir=1,a[this.color_idx]>.95&&(this.color_dir=-1)}switch(this.color_idx){case 0:e.x+=.05*this.color_dir,a[0]=e.x;break;case 1:e.y+=.05*this.color_dir,a[1]=e.y;break;case 2:e.z+=.05*this.color_dir,a[2]=e.z}return 1==this.color_dir&&a[this.color_idx]>.95&&(this.color_dir=-1,this.color_idx=-1),-1==this.color_dir&&a[this.color_idx]<.05&&(this.color_dir=1,this.color_idx=-1),e}static randomNum(t){return Math.floor(Math.random()*t)}}s.camera=null,s.scene=null,s.game_ui=null,s.bottomCube=null;var i=Laya.Event;class r extends t.test.TestSceneUI{constructor(){super(),this.allLables=new Array,this.bestScore=0,s.game_ui=this,this.box_combo.visible=!1,this.box_tower.visible=!1,this.allLables.push(this.lable_0),this.allLables.push(this.lable_1),this.allLables.push(this.lable_2),this.allLables.push(this.lable_3),this.allLables.push(this.lable_4),this.allLables.push(this.lable_5),this.allLables.push(this.lable_6),this.allLables.push(this.lable_7),this.allLables.push(this.lable_8),this.allLables.push(this.lable_9),this.allLables.forEach(t=>{t.text=""}),this.btn_start.on(i.MOUSE_DOWN,this,this.OnStart),this.OnRestart()}OnRestart(){this.bestScore=r.getLocalStorage("bestScore",0),this.lblBestScore.text=""+this.bestScore}OnStart(t){t.stopPropagation(),this.box_start.visible=!1,this.lable_score.visible=!0,this.box_tower.visible=!1,s.getInstance().Init()}SetCombo(t){if(this.box_combo.visible=!0,this.box_combo.scaleX=0,this.box_combo.scaleY=0,t>=100){let e=t%10,a=Math.floor(t/10)%10,o=Math.floor(t/100)%10;this.img_digtal_0.visible=!0,this.img_digtal_1.visible=!0,this.img_digtal_2.visible=!0,this.img_digtal_0.skin="comp/img_ddt_n"+o+".png",this.img_digtal_1.skin="comp/img_ddt_n"+a+".png",this.img_digtal_2.skin="comp/img_ddt_n"+e+".png"}else if(t>=10){let e=t%10,a=Math.floor(t/10)%10;this.img_digtal_0.visible=!0,this.img_digtal_1.visible=!0,this.img_digtal_2.visible=!1,this.img_digtal_0.skin="comp/img_ddt_n"+a+".png",this.img_digtal_1.skin="comp/img_ddt_n"+e+".png"}else{let e=t%10;this.img_digtal_0.visible=!0,this.img_digtal_1.visible=!1,this.img_digtal_2.visible=!1,this.img_digtal_0.skin="comp/img_ddt_n"+e+".png"}Laya.Tween.to(this.box_combo,{scaleX:1,scaleY:1},250,Laya.Ease.elasticOut,Laya.Handler.create(this,()=>{Laya.Tween.to(this.box_combo,{scaleX:0,scaleY:0},250,Laya.Ease.linearInOut,Laya.Handler.create(this,()=>{this.box_combo.visible=!1}),100)}))}ShowTowerName(t){this.box_tower.visible=!0,this.allLables.forEach(t=>{t.scaleX=0,t.scaleY=0,t.text=""});let e="香格里拉大酒店";e=t<40?"香格里拉大酒店":t<80?"南京紫峰大厦":t<100?"长沙国际金融中心":t<120?"武汉绿地中心":t<140?"香港环球贸易广场":t<160?"上海环球金融中心":t<180?"台北101大厦":t<200?"北京中国尊":t<220?"广州周大福金融中心":t<240?"天津周大福滨海中心":t<260?"深圳平安国际金融中心":t<280?"天津117大厦":"上海中心",t>this.bestScore&&(this.bestScore=t,r.setLocalStorage("bestScore",t));for(let t=0;t<e.length;++t)this.allLables[t].text=e[t],Laya.Tween.to(this.allLables[t],{scaleX:1,scaleY:1},500,Laya.Ease.sineOut,null,300*t)}static getLocalStorage(t,e){var a=e,o=Laya.LocalStorage.getItem(t);return o?isNaN(o)?(a=e,Laya.LocalStorage.setItem(t,a)):a=parseInt(o):(a=e,Laya.LocalStorage.setItem(t,a)),a}static setLocalStorage(t,e){Laya.LocalStorage.setItem(t,e)}}class l{constructor(){}static init(){(0,Laya.ClassUtils.regClass)("script/GameUI.ts",r)}}l.width=750,l.height=1200,l.scaleMode="fixedwidth",l.screenMode="vertical",l.alignV="top",l.alignH="left",l.startScene="test/TestScene.scene",l.sceneRoot="",l.debug=!1,l.stat=!1,l.physicsDebug=!1,l.exportSceneToJson=!0,l.init();new class{constructor(){console.log("===1");let t=new Config3D;t.isAntialias=!0,t.isAlpha=!1,Laya3D.init(l.width,l.height,t),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=l.scaleMode,Laya.stage.screenMode=l.screenMode,Laya.stage.alignV=l.alignV,Laya.stage.alignH=l.alignH,Laya.URL.exportSceneToJson=l.exportSceneToJson,(l.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),l.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),l.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onPreLoadFinish))}onPreLoadFinish(){Laya.Scene3D.load("scene/LayaScene_SampleScene/Conventional/SampleScene.ls",Laya.Handler.create(this,function(t){s.scene=t,Laya.stage.addChild(t),console.log("--"+Laya.stage.numChildren),s.camera=t.getChildByName("Main Camera"),s.camera.clearFlag=Laya.BaseCamera.CLEARFLAG_DEPTHONLY,s.bottomCube=t.getChildByName("Cube"),s.getInstance().top_box_color=new Laya.Vector4(Math.random(),Math.random(),Math.random(),1),s.bottomCube.meshRenderer.material.albedoColor=s.getInstance().top_box_color,s.camera.removeAllLayers(),s.camera.addLayer(1),s.bottomCube.layer=1;let e=t.getChildByName("BGCamera"),a=t.getChildByName("Plane_1"),o=t.getChildByName("Plane_2");a.layer=10,o.layer=10,e.clearFlag=Laya.BaseCamera.CLEARFLAG_DEPTHONLY,e.removeAllLayers(),e.addLayer(10);let i=new Laya.EffectMaterial;Laya.Texture2D.load("bg/img_fyd_bg"+s.randomNum(10)+".jpg",Laya.Handler.create(this,function(t){i.texture=t})),i.colorA=.01,a.meshRenderer.material=i,s.getInstance().bg_front=i;let r=new Laya.BlinnPhongMaterial;Laya.Texture2D.load("bg/img_fyd_bg"+s.randomNum(9)+".jpg",Laya.Handler.create(this,function(t){r.albedoTexture=t})),r.albedoColorA=.1,o.meshRenderer.material=r,s.getInstance().bg_black=r,l.startScene&&Laya.Scene.open(l.startScene,!1)}))}}}();